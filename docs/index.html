<!doctype html>

<html lang="de">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b1021">
<title>Grid Mean-Reversion Top-15</title>
<style>
  :root { --fg:#101218; --muted:#586174; --bg:#ffffff; --chip:#eef1f6; }
  @media (prefers-color-scheme: dark) {
    :root { --fg:#e8ecf1; --muted:#9aa3b2; --bg:#0b1021; --chip:#171c30; }
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:16px system-ui, -apple-system, Segoe UI, Roboto, sans-serif}
  header{position:sticky;top:0;background:var(--bg);padding:12px 16px;border-bottom:1px solid rgba(0,0,0,.06)}
  h1{font-size:18px;margin:0}
  .muted{color:var(--muted);font-size:12px}
  main{padding:12px 8px 80px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px 8px;border-bottom:1px solid rgba(0,0,0,.06);text-align:left;font-variant-numeric:tabular-nums}
  th{position:sticky;top:56px;background:var(--bg);z-index:1}
  .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
  .chip{background:var(--chip);border-radius:12px;padding:4px 8px;font-size:12px}
  .toolbar{display:flex;gap:8px;align-items:center;margin:8px 0}
  select,button{font:inherit;border:1px solid rgba(0,0,0,.15);border-radius:10px;padding:6px 10px;background:transparent;color:inherit}
  tfoot td{padding:12px 8px}
  .foot{color:var(--muted);font-size:12px}
</style>
<header>
  <h1>Grid Mean-Reversion Top-15</h1>
  <div class="muted" id="stamp">Lade Daten…</div>
  <div class="chips">
    <div class="chip">±3% Haupt-Schwelle</div>
    <div class="chip">1h & 1d</div>
    <div class="chip">Auto-Update (daily)</div>
    <div class="chip">PWA</div>
  </div>
</header>
<main>
  <div class="toolbar">
    <label class="muted">Sortieren:</label>
    <select id="sort">
      <option value="Rank">Rank</option>
      <option value="Hitrate ±3%">Hitrate ±3%</option>
      <option value="Net P&L/Trade">Net P&L/Trade</option>
      <option value="Signals/W">Signals/W</option>
      <option value="MaxDD">MaxDD</option>
      <option value="Robustness">Robustness</option>
    </select>
    <button id="dir">↑</button>
  </div>
  <table id="t"><thead><tr></tr></thead><tbody></tbody><tfoot><tr><td class="foot" colspan="10">
    Nicht-finanzielle Forschung; keine Live-Orders. Kosten & konservative Slippage berücksichtigt.
  </td></tr></tfoot></table>
</main>
<script>
  const thead = document.querySelector('#t thead tr');
  const tbody = document.querySelector('#t tbody');
  const stamp = document.querySelector('#stamp');
  const sortSel = document.querySelector('#sort');
  const dirBtn = document.querySelector('#dir');
  let rows = [], cols = [], asc = true;
  function renderHeader() {
    thead.innerHTML = '';
    cols.forEach(c => { const th = document.createElement('th'); th.textContent = c; thead.appendChild(th); });
  }
  function renderBody() {
    tbody.innerHTML = '';
    rows.forEach(r => {
      const tr = document.createElement('tr');
      r.forEach((c)=>{ const td = document.createElement('td'); td.textContent = c; tr.appendChild(td); });
      tbody.appendChild(tr);
    });
  }
  function resort() {
    const key = sortSel.value;
    const idx = cols.indexOf(key);
    rows.sort((a,b)=>{
      const x=a[idx], y=b[idx];
      const nx = parseFloat(String(x).replace('%','').replace('h','').replace('$','').replace('M',''));
      const ny = parseFloat(String(y).replace('%','').replace('h','').replace('$','').replace('M',''));
      if(!isNaN(nx) && !isNaN(ny)) return asc ? nx - ny : ny - nx;
      return asc ? String(x).localeCompare(String(y)) : String(y).localeCompare(String(x));
    });
    renderBody();
  }
  dirBtn.onclick = ()=>{ asc=!asc; dirBtn.textContent = asc ? '↑' : '↓'; resort(); };
  sortSel.onchange = resort;
  fetch('top15.json', {cache:'no-store'}).then(r=>r.json()).then(d=>{
    cols = d.columns || ["Rank","Ticker","Signals/W","Hitrate ±3%","Net P&L/Trade","Median Hold","24h Vol","MaxDD","Robustness","Notes"];
    rows = d.rows || [];
    stamp.textContent = 'Updated: ' + (d.updated || 'unknown');
    renderHeader(); renderBody();
  }).catch(_=>{ stamp.textContent = 'Keine Daten gefunden.'; });
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js'); }
</script>
</html>
